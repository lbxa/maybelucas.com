---
import { getCollection } from "astro:content";
import dayjs from "dayjs";
import ContentLayout from "@layouts/ContentLayout.astro";
import Title from "@components/Title.astro";
import ReadingTime from "@components/ReadingTime.astro";

const pageTitle = "All Posts | Lucas Barbosa";
const pageDescription =
  "Browse the full archive of Lucas Barbosa's writing, sorted by recency with reading times.";
// Keep canonicalPath per page (e.g., /posts/page/2) if pagination/filters are added.
const canonicalPath = "/posts";
const dateFormat = "MMMM D, YYYY";

const posts = (await getCollection("blog")).sort((a, b) =>
  dayjs(a.data.date).isBefore(dayjs(b.data.date)) ? 1 : -1
);
---

<ContentLayout
  title={pageTitle}
  description={pageDescription}
  url={canonicalPath}
  type="website"
>
  <section class="font-mono">
    <Title>Posts</Title>
    <p class="mb-3xl">Toward escape velocity</p>
  </section>
  <section class="font-mono">
    {
      posts.map((p) => (
        <div class="flex flex-col gap-sm mb-xl">
          <a
            class="hover:underline focus:underline visited:text-purple-600 truncate"
            href={"/posts/" + p.slug}
          >
            {p.data.title.trim()}
          </a>
          <div class="text-gray-700 dark:text-gray-400 text-xs">
            <ReadingTime content={p.body} />
            <span class="font-sans">â€¢</span>
            <span>{dayjs(p.data.date).format(dateFormat)}</span>
          </div>
        </div>
      ))
    }
  </section>
</ContentLayout>
